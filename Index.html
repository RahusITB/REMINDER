<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXEIGHTED X-8 | Database Pribadi</title>
    
    <!-- Library CSS & Font -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    
    <!-- React & Babel untuk menjalankan kode modern di browser -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; -webkit-tap-highlight-color: transparent; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .animate-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <!-- Firebase SDK (Menghubungkan ke Database Kamu) -->
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-app.js";
    import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-firestore.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.2.0/firebase-auth.js";

    // INI API KEY MILIK KAMU YANG BARU
    const firebaseConfig = {
        apiKey: "AIzaSyC7Dlgc7nvO5C4TpGK78JLiMgpUPhFOzA0",
        authDomain: "exeighted-site.firebaseapp.com",
        projectId: "exeighted-site",
        storageBucket: "exeighted-site.firebasestorage.app",
        messagingSenderId: "2577177460",
        appId: "1:2577177460:web:58c870583cf4dd25c06a21",
        measurementId: "G-W19QT6WZ8W"
    };

    try {
        // Inisialisasi
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);
        const appId = "exeighted-x8-main"; // ID unik untuk data kelasmu

        // Kirim ke global window agar bisa dibaca oleh React di bawah
        window.X8_CLOUD = { 
            db, 
            doc, 
            setDoc, 
            onSnapshot, 
            auth, 
            signInAnonymously,
            appId,
            isInitialized: true 
        };
        
        console.log("‚úÖ Firebase berhasil diinisialisasi");
    } catch (error) {
        console.error("‚ùå Error inisialisasi Firebase:", error);
        window.X8_CLOUD = { 
            error: true, 
            message: error.message,
            isInitialized: false 
        };
    }
</script>

    <!-- Logic Aplikasi -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        const App = () => {
            const [activeTab, setActiveTab] = useState('beranda');
            const [isAdmin, setIsAdmin] = useState(false);
            const [showLogin, setShowLogin] = useState(false);
            const [password, setPassword] = useState('');
            const [loading, setLoading] = useState(true);
            const [user, setUser] = useState(null);

            const ADMIN_PASS = "Navila139"; 

            // State Data Default
            const [classData, setClassData] = useState({
                waliKelas: "Bu Yefniarti",
                siswa: [
                    { nama: "Rahus", jabatan: "Ketua Kelas" }, { nama: "Ala", jabatan: "Wakil Ketua Kelas" },
                    { nama: "Hasya", jabatan: "Sekretaris I" }, { nama: "Paja", jabatan: "Sekretaris II" },
                    { nama: "Chandra", jabatan: "Bendahara I" }, { nama: "Nikei", jabatan: "Bendahara II" }
                ],
                jadwalMingguan: {
                    Senin: ["Akidah", "Informatika", "Bahasa Arab", "Tata Boga"],
                    Selasa: ["Fisika", "PKN", "PJOK", "SKI", "Geografi"],
                    Rabu: ["Bahasa Inggris", "Bahasa Indonesia", "Sosiologi", "Riset"],
                    Kamis: ["Tahfidz", "Matematika", "Fikih", "Sejarah", "Bahasa Arab"],
                    Jumat: ["Ekonomi", "QURDIS", "Seni Budaya", "Biologi", "Kimia"]
                },
                harian: { 
                    pembiasaanBesok: "Belum diatur", 
                    tugasPerMapel: {}, 
                    jurnalHariIni: [] 
                }
            });

            useEffect(() => {
    const initFirebase = setInterval(() => {
        if (window.X8_CLOUD && window.X8_CLOUD.isInitialized) {
            clearInterval(initFirebase);
            
            const { auth, db, doc, onSnapshot, appId, signInAnonymously } = window.X8_CLOUD;
            
            // Login anonymous
            signInAnonymously(auth)
                .then((cred) => {
                    setUser(cred.user);
                    console.log("‚úÖ Login anonymous berhasil");
                    
                    // Path sesuai aturan
                    const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'main_config');
                    
                    // Listen to real-time updates
                    const unsubscribe = onSnapshot(docRef, 
                        (snap) => {
                            if (snap.exists()) {
                                console.log("‚úÖ Data diterima dari Firestore");
                                setClassData(snap.data());
                            } else {
                                console.log("üìù Database kosong, membuat data awal...");
                                // Jika database masih kosong, buat data awal
                                setDoc(docRef, classData)
                                    .then(() => console.log("‚úÖ Data awal berhasil dibuat"))
                                    .catch(err => console.error("‚ùå Gagal membuat data awal:", err));
                            }
                            setLoading(false);
                        },
                        (err) => {
                            console.error("‚ùå Firestore Error:", err);
                            alert("Terjadi error koneksi database. Cek console untuk detail.");
                            setLoading(false);
                        }
                    );
                    
                    // Cleanup function
                    return () => unsubscribe();
                })
                .catch((error) => {
                    console.error("‚ùå Login anonymous gagal:", error);
                    alert("Gagal koneksi ke server. Pastikan internet tersedia.");
                    setLoading(false);
                });
        } else if (window.X8_CLOUD && window.X8_CLOUD.error) {
            // Jika ada error inisialisasi
            clearInterval(initFirebase);
            console.error("‚ùå Firebase error:", window.X8_CLOUD.message);
            alert("Gagal menghubungkan ke Firebase. Cek API key dan konfigurasi.");
            setLoading(false);
        }
    }, 500); // Interval dinaikkan menjadi 500ms
    
    // Cleanup interval
    return () => clearInterval(initFirebase);
}, []);

            const saveChanges = async () => {
                const { db, doc, setDoc, appId } = window.X8_CLOUD;
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'main_config');
                try {
                    await setDoc(docRef, classData);
                    alert("‚úÖ Data Berhasil Disimpan ke Cloud!");
                    setIsAdmin(false);
                } catch (e) { 
                    alert("Gagal menyimpan. Pastikan Firestore 'Rules' sudah di-set ke test mode."); 
                }
            };

            const getBesok = () => {
                const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
                const t = new Date(); t.setDate(t.getDate() + 1);
                return days[t.getDay()];
            };
            const besok = getBesok();

            if (loading) return (
                <div className="h-screen flex items-center justify-center bg-indigo-600 text-white font-black animate-pulse tracking-widest">
                    MENYAMBUNGKAN KE DATABASE...
                </div>
            );

            return (
                <div className="min-h-screen pb-32">
                    <header className="bg-indigo-700 text-white p-7 shadow-xl rounded-b-[3rem] flex justify-between items-center sticky top-0 z-50">
                        <div>
                            <h1 className="text-2xl font-black italic tracking-tighter">EXEIGHTED</h1>
                            <p className="text-[8px] font-bold opacity-60 tracking-[0.3em] uppercase">Private Cloud Hub</p>
                        </div>
                        <button onClick={() => setShowLogin(true)} className="p-3 bg-white/20 rounded-2xl">‚öôÔ∏è</button>
                    </header>

                    <main className="max-w-xl mx-auto p-5 mt-4 space-y-4 animate-in">
                        {activeTab === 'beranda' && (
                            <div className="bg-white p-7 rounded-[2.5rem] shadow-sm border border-slate-100">
                                <h2 className="text-indigo-700 font-black mb-5 flex items-center gap-2 italic">üìÖ AGENDA {besok.toUpperCase()}</h2>
                                <div className="bg-amber-50 p-6 rounded-3xl border-l-8 border-amber-400 mb-6 font-bold text-slate-700">
                                    {classData.harian.pembiasaanBesok}
                                </div>
                                <div className="space-y-3">
                                    {(classData.jadwalMingguan[besok] || []).map((m, i) => (
                                        <div key={i} className="bg-slate-50 p-4 rounded-2xl border border-slate-100">
                                            <span className="font-black text-indigo-700 text-sm block uppercase">{m}</span>
                                            <p className="text-[11px] text-slate-500 mt-1 italic">
                                                {classData.harian.tugasPerMapel[m] || "‚ú® Tidak ada tugas"}
                                            </p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'informasi' && (
                            <div className="bg-white p-7 rounded-[2.5rem] shadow-sm border border-slate-100">
                                <h3 className="font-black text-lg mb-6 text-indigo-700 italic">üë• STRUKTUR KELAS</h3>
                                <div className="grid grid-cols-1 gap-2">
                                    {classData.siswa.map((s, i) => (
                                        <div key={i} className="flex justify-between items-center p-4 bg-slate-50 rounded-2xl">
                                            <span className="font-bold text-slate-700 text-sm">{s.nama}</span>
                                            <span className="text-[9px] px-3 py-1 rounded-lg font-black uppercase bg-indigo-600 text-white italic">{s.jabatan}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {activeTab === 'jurnal' && (
                            <div className="space-y-4">
                                <h2 className="font-black text-xl italic text-indigo-700 px-2 tracking-tighter">üìñ JURNAL KELAS</h2>
                                {classData.harian.jurnalHariIni.length > 0 ? classData.harian.jurnalHariIni.map((j, i) => (
                                    <div key={i} className="bg-white p-7 rounded-[2.5rem] shadow-sm border border-l-[12px] border-emerald-500">
                                        <p className="font-black text-emerald-600 mb-1 text-xs uppercase">{j.pelajaran}</p>
                                        <p className="text-slate-800 text-lg font-bold mb-3 leading-tight">{j.materi}</p>
                                        <div className="bg-emerald-50 text-emerald-700 px-4 py-2 rounded-xl text-[10px] font-black uppercase inline-block">
                                            Tugas: {j.tugas || 'Nihil'}
                                        </div>
                                    </div>
                                )) : <div className="text-center p-10 text-slate-300 font-bold italic">Belum ada jurnal hari ini</div>}
                            </div>
                        )}
                    </main>

                    <nav className="fixed bottom-8 left-8 right-8 bg-white/90 backdrop-blur-2xl border border-slate-200 h-24 rounded-[3rem] flex justify-around items-center z-50 shadow-2xl">
                        {[
                            { id: 'beranda', icon: 'üè†', label: 'AGENDA' },
                            { id: 'informasi', icon: 'üë•', label: 'PERSONEL' },
                            { id: 'jurnal', icon: 'üìñ', label: 'JURNAL' }
                        ].map((t) => (
                            <button key={t.id} onClick={() => setActiveTab(t.id)} className={`flex flex-col items-center gap-1 transition-all ${activeTab === t.id ? 'text-indigo-600 scale-110' : 'text-slate-300 opacity-60'}`}>
                                <span className="text-2xl">{t.icon}</span>
                                <span className="text-[9px] font-black tracking-widest uppercase">{t.label}</span>
                            </button>
                        ))}
                    </nav>

                    {isAdmin && (
                        <div className="fixed inset-0 bg-white z-[100] p-6 overflow-y-auto">
                            <div className="flex justify-between items-center mb-8">
                                <h2 className="text-2xl font-black italic text-indigo-700 uppercase">Admin Editor</h2>
                                <button onClick={() => setIsAdmin(false)} className="p-3 bg-slate-100 rounded-2xl font-black text-xs">TUTUP</button>
                            </div>
                            <div className="space-y-8 pb-32">
                                <section className="space-y-3">
                                    <label className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Pembiasaan Besok</label>
                                    <input className="w-full p-5 bg-slate-50 rounded-[2rem] font-bold outline-none border-2 border-transparent focus:border-indigo-500" value={classData.harian.pembiasaanBesok} onChange={(e) => setClassData({...classData, harian: {...classData.harian, pembiasaanBesok: e.target.value}})} />
                                </section>

                                <section className="space-y-4">
                                    <div className="flex justify-between items-center">
                                        <h4 className="text-[10px] font-black text-slate-400 uppercase tracking-widest">Kelola Jurnal</h4>
                                        <button onClick={() => setClassData({...classData, harian: {...classData.harian, jurnalHariIni: [...classData.harian.jurnalHariIni, {pelajaran: "", materi: "", tugas: ""}]}})} className="text-[10px] font-black text-indigo-600 bg-indigo-50 px-3 py-2 rounded-xl">+ TAMBAH</button>
                                    </div>
                                    {classData.harian.jurnalHariIni.map((j, i) => (
                                        <div key={i} className="p-6 bg-slate-50 rounded-[2.5rem] space-y-3 border-2 border-slate-100 relative">
                                            <input placeholder="Mapel" className="w-full p-3 rounded-xl font-bold" value={j.pelajaran} onChange={(e) => {
                                                const nj = [...classData.harian.jurnalHariIni]; nj[i].pelajaran = e.target.value;
                                                setClassData({...classData, harian: {...classData.harian, jurnalHariIni: nj}});
                                            }} />
                                            <textarea placeholder="Materi" className="w-full p-3 rounded-xl" value={j.materi} onChange={(e) => {
                                                const nj = [...classData.harian.jurnalHariIni]; nj[i].materi = e.target.value;
                                                setClassData({...classData, harian: {...classData.harian, jurnalHariIni: nj}});
                                            }} />
                                            <input placeholder="Tugas" className="w-full p-3 rounded-xl" value={j.tugas} onChange={(e) => {
                                                const nj = [...classData.harian.jurnalHariIni]; nj[i].tugas = e.target.value;
                                                setClassData({...classData, harian: {...classData.harian, jurnalHariIni: nj}});
                                            }} />
                                            <button onClick={() => {
                                                const nj = classData.harian.jurnalHariIni.filter((_, idx) => idx !== i);
                                                setClassData({...classData, harian: {...classData.harian, jurnalHariIni: nj}});
                                            }} className="text-rose-500 font-black text-[10px] uppercase w-full">Hapus Item</button>
                                        </div>
                                    ))}
                                </section>
                            </div>
                            <button onClick={saveChanges} className="fixed bottom-8 left-8 right-8 p-6 bg-indigo-600 text-white rounded-[2.5rem] font-black shadow-2xl active:scale-95 transition-all">SIMPAN PERUBAHAN KE CLOUD</button>
                        </div>
                    )}

                    {showLogin && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-md z-[110] flex items-center justify-center p-6">
                            <div className="bg-white w-full max-w-sm rounded-[3.5rem] p-10 text-center shadow-2xl">
                                <h3 className="text-xl font-black mb-6 italic text-indigo-700 uppercase">Admin Access</h3>
                                <input type="password" placeholder="Password" className="w-full p-5 bg-slate-100 rounded-[2rem] mb-4 text-center font-bold outline-none border-2 border-transparent focus:border-indigo-400" value={password} onChange={(e) => setPassword(e.target.value)} />
                                <button onClick={() => { if(password === ADMIN_PASS){setIsAdmin(true); setShowLogin(false); setPassword('');} else alert("Salah!"); }} className="w-full p-5 bg-indigo-600 text-white rounded-[2rem] font-black shadow-lg">MASUK</button>
                                <button onClick={() => setShowLogin(false)} className="mt-4 text-slate-400 text-[10px] font-black uppercase tracking-widest">Batal</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>